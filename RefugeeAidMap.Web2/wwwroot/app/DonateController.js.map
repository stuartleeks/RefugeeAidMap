{"version":3,"sources":["DonateController.ts"],"names":["Donate","Donate.Controller","Donate.Controller.constructor","Donate.Controller.initMap","Donate.Controller.searchClicked"],"mappings":"AAAA,AAEA,+DAF+D;AAC/D,0DAA0D;AAC1D,IAAO,MAAM,CAoGZ;AApGD,WAAO,MAAM,EAAC,CAAC;IAUXA;QAWIC,oBACYA,OAAgBA,EAChBA,MAAiBA;YAbjCC,iBAyFCA;YA7EeA,YAAOA,GAAPA,OAAOA,CAASA;YAChBA,WAAMA,GAANA,MAAMA,CAAWA;YAEzBA,IAAIA,CAACA,OAAOA,GAAGA,QAAQA,CAACA;YAGxBA,MAAMA,CAACA,GAAGA,CACNA,eAAeA,EACfA,UAACA,KAAKA,EAAEA,OAAsBA;gBAC1BA,KAAIA,CAACA,OAAOA,GAAGA,OAAOA,CAACA;gBACvBA,IAAIA,UAAUA,GAAGA,IAAIA,MAAMA,CAACA,IAAIA,CAACA,UAAUA,CAACA;oBACxCA,OAAOA,EAAEA,QAAQA,CAACA,cAAcA,CAACA,mBAAmBA,CAACA;iBACxDA,CAACA,CAACA;gBACHA,KAAIA,CAACA,OAAOA,CAACA,OAAOA,CAACA,UAAAA,CAACA;oBAClBA,IAAIA,SAASA,GAAGA,IAAIA,MAAMA,CAACA,IAAIA,CAACA,MAAMA,CAACA;wBACnCA,QAAQA,EAAEA,IAAIA,MAAMA,CAACA,IAAIA,CAACA,MAAMA,CAACA,CAACA,CAACA,GAAGA,EAAEA,CAACA,CAACA,GAAGA,CAACA;wBAC9CA,KAAKA,EAAEA,CAACA,CAACA,KAAKA;qBACjBA,CAACA,CAACA;oBACHA,SAASA,CAACA,WAAWA,CAACA,OAAOA,EAAEA;wBAC3BA,UAAUA,CAACA,KAAKA,EAAEA,CAACA;wBACnBA,KAAIA,CAACA,aAAaA,GAAGA,CAACA,CAACA;wBACvBA,MAAMA,CAACA,MAAMA,EAAEA,CAACA;wBAChBA,UAAUA,CAACA,IAAIA,CAACA,KAAIA,CAACA,GAAGA,EAAEA,SAASA,CAACA,CAACA;oBACzCA,CAACA,CAACA,CAACA;oBACHA,SAASA,CAACA,MAAMA,CAACA,KAAIA,CAACA,GAAGA,CAACA,CAACA;gBAC/BA,CAACA,CAACA,CAACA;YACPA,CAACA,CAACA,CAACA;YAEPA,IAAIA,CAACA,OAAOA,CAACA,WAAWA,EAAEA,CAACA;YAE3BA,IAAIA,CAACA,OAAOA,CAACA,eAAeA,CAACA,EAAEA,wCAAwCA;YAEvEA,IAAIA,CAACA,QAAQA,GAAGA,IAAIA,MAAMA,CAACA,IAAIA,CAACA,QAAQA,EAAEA,CAACA;QAC/CA,CAACA;;QAGDD,4BAAOA,GAAPA,UAAQA,YAAoBA;YAA5BE,iBA0BCA;YAzBGA,IAAIA,UAAUA,GAAGA,QAAQA,CAACA,cAAcA,CAACA,YAAYA,CAACA,CAACA;YACvDA,IAAIA,OAAOA,GAA2BA;gBAClCA,MAAMA,EAAEA,IAAIA,MAAMA,CAACA,IAAIA,CAACA,MAAMA,CAACA,KAAKA,EAAEA,CAACA,CAACA;gBACxCA,SAASA,EAAEA,MAAMA,CAACA,IAAIA,CAACA,SAASA,CAACA,OAAOA;gBACxCA,IAAIA,EAAEA,CAACA;aACVA,CAACA;YACFA,IAAIA,CAACA,GAAGA,GAAGA,IAAIA,MAAMA,CAACA,IAAIA,CAACA,GAAGA,CAACA,UAAUA,EAAEA,OAAOA,CAACA,CAACA;YAGpDA,EAAEA,CAACA,CAACA,SAASA,CAACA,WAAWA,CAACA,CAACA,CAACA;gBACxBA,IAAIA,CAACA,OAAOA,GAAGA,0BAA0BA,CAACA;gBAC1CA,SAASA,CAACA,WAAWA,CAACA,kBAAkBA,CACpCA,UAAAA,QAAQA;oBACJA,KAAIA,CAACA,MAAMA,CAACA,MAAMA,CAACA,cAAMA,OAAAA,KAAIA,CAACA,OAAOA,GAAGA,IAAIA,EAAnBA,CAAmBA,CAACA,CAACA;oBAE9CA,IAAIA,GAAGA,GAAGA;wBACNA,GAAGA,EAAEA,QAAQA,CAACA,MAAMA,CAACA,QAAQA;wBAC7BA,GAAGA,EAAEA,QAAQA,CAACA,MAAMA,CAACA,SAASA;qBACjCA,CAACA;oBAEFA,KAAIA,CAACA,GAAGA,CAACA,SAASA,CAACA,GAAGA,CAACA,CAACA;oBACxBA,KAAIA,CAACA,GAAGA,CAACA,OAAOA,CAACA,EAAEA,CAACA,CAACA;gBACzBA,CAACA,EACDA,UAAAA,CAACA,IAAIA,OAAAA,KAAIA,CAACA,OAAOA,GAAGA,6BAA6BA,EAA5CA,CAA4CA,CAACA,CAACA;YAC3DA,CAACA;QACLA,CAACA;QAEDF,kCAAaA,GAAbA;YAAAG,iBAYCA;YAXGA,IAAIA,WAAWA,GAAGA,IAAIA,CAACA,WAAWA,CAACA;YACnCA,IAAIA,CAACA,OAAOA,GAAGA,cAAcA,CAACA;YAC9BA,IAAIA,CAACA,QAAQA,CAACA,OAAOA,CAACA,EAAEA,OAAOA,EAAEA,WAAWA,EAAEA,EAAEA,UAACA,OAAOA,EAAEA,MAAMA;gBAC5DA,EAAEA,CAACA,CAACA,MAAMA,KAAKA,MAAMA,CAACA,IAAIA,CAACA,cAAcA,CAACA,EAAEA,CAACA,CAACA,CAACA;oBAC3CA,KAAIA,CAACA,GAAGA,CAACA,SAASA,CAACA,OAAOA,CAACA,CAACA,CAACA,CAACA,QAAQA,CAACA,QAAQA,CAACA,CAACA;oBACjDA,KAAIA,CAACA,OAAOA,GAAGA,EAAEA,CAACA;gBACtBA,CAACA;gBAACA,IAAIA,CAACA,CAACA;oBACJA,KAAIA,CAACA,OAAOA,GAAGA,gBAAgBA,GAAGA,WAAWA,CAACA;gBAClDA,CAACA;gBACDA,KAAIA,CAACA,MAAMA,CAACA,MAAMA,EAAEA,CAACA;YACzBA,CAACA,CAACA,CAACA;QACPA,CAACA;QA/EMH,kBAAOA,GAAGA,CAACA,eAAeA,EAAEA,QAAQA,CAACA,CAACA;QAgFjDA,iBAACA;IAADA,CAzFAD,AAyFCC,IAAAD;IAzFYA,iBAAUA,aAyFtBA,CAAAA;AACLA,CAACA,EApGM,MAAM,KAAN,MAAM,QAoGZ;AAED,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC;KAChB,UAAU,CAAC,kBAAkB,EAAE,MAAM,CAAC,UAAU,CAAC,CAAC","file":"DonateController.js","sourcesContent":["/// <reference path=\"../typings/googlemaps/google.maps.d.ts\" />\r\n/// <reference path=\"../typings/angularjs/angular.d.ts\" />\r\nmodule Donate {\r\n    export interface IMarkerInfo {\r\n        title: string,\r\n        lat: number,\r\n        lng: number,\r\n        groupLink: string,\r\n        postcode: string,\r\n        locale: string,\r\n        business: string\r\n    }\r\n    export class Controller {\r\n        message: string;\r\n        markers: IMarkerInfo[]\r\n        currentMarker: IMarkerInfo;\r\n        map: google.maps.Map;\r\n        geocoder: google.maps.Geocoder;\r\n\r\n        searchValue: string;\r\n\r\n        static $inject = ['donateService', '$scope'];\r\n\r\n        constructor(\r\n            private service: Service,\r\n            private $scope: ng.IScope\r\n            ) {\r\n            this.message = 'Hello!';\r\n\r\n\r\n            $scope.$on(\r\n                'markersLoaded',\r\n                (event, markers: IMarkerInfo[]) => {\r\n                    this.markers = markers;\r\n                    var infoWindow = new google.maps.InfoWindow({\r\n                        content: document.getElementById('infoWindowContent')\r\n                    });\r\n                    this.markers.forEach(m=> {\r\n                        var mapMarker = new google.maps.Marker({\r\n                            position: new google.maps.LatLng(m.lat, m.lng),\r\n                            title: m.title\r\n                        });\r\n                        mapMarker.addListener('click', () => {\r\n                            infoWindow.close();\r\n                            this.currentMarker = m;\r\n                            $scope.$apply();\r\n                            infoWindow.open(this.map, mapMarker);\r\n                        });\r\n                        mapMarker.setMap(this.map);\r\n                    });\r\n                });\r\n\r\n            this.service.loadMarkers();\r\n\r\n            this.initMap('map-container'); // TODO - hook this up in a directive???\r\n\r\n            this.geocoder = new google.maps.Geocoder();\r\n        };\r\n\r\n\r\n        initMap(mapElementId: string) {\r\n            var mapElement = document.getElementById(mapElementId);\r\n            var options: google.maps.MapOptions = {\r\n                center: new google.maps.LatLng(51.48, 0),\r\n                mapTypeId: google.maps.MapTypeId.ROADMAP,\r\n                zoom: 5\r\n            };\r\n            this.map = new google.maps.Map(mapElement, options);\r\n\r\n\r\n            if (navigator.geolocation) {\r\n                this.message = 'Finding your location...';\r\n                navigator.geolocation.getCurrentPosition(\r\n                    position => {\r\n                        this.$scope.$apply(() => this.message = null);\r\n\r\n                        var pos = {\r\n                            lat: position.coords.latitude,\r\n                            lng: position.coords.longitude\r\n                        };\r\n\r\n                        this.map.setCenter(pos);\r\n                        this.map.setZoom(10);\r\n                    },\r\n                    e => this.message = 'Failed to get your location');\r\n            }\r\n        }\r\n\r\n        searchClicked() {\r\n            var searchValue = this.searchValue;\r\n            this.message = 'Searching...';\r\n            this.geocoder.geocode({ address: searchValue }, (results, status) => {\r\n                if (status === google.maps.GeocoderStatus.OK) {\r\n                    this.map.setCenter(results[0].geometry.location);\r\n                    this.message = '';\r\n                } else {\r\n                    this.message = \"Couldn't find \" + searchValue;\r\n                }\r\n                this.$scope.$apply();\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\nangular.module('app')\r\n    .controller('donateController', Donate.Controller);\r\n"],"sourceRoot":"/source/"}