{"version":3,"sources":["DonateController.ts"],"names":["Donate","Donate.Controller","Donate.Controller.constructor","Donate.Controller.initMap"],"mappings":"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","file":"DonateController.js","sourcesContent":["/// <reference path=\"../typings/googlemaps/google.maps.d.ts\" />\r\n/// <reference path=\"../typings/angularjs/angular.d.ts\" />\r\nmodule Donate {\r\n    export interface IMarkerInfo {\r\n        title: string,\r\n        lat: number,\r\n        lng: number\r\n    }\r\n    export class Controller {\r\n        message: string;\r\n        markers: IMarkerInfo[]\r\n        currentMarker: IMarkerInfo;\r\n        currentInfoWindow: google.maps.InfoWindow;\r\n        map: google.maps.Map;\r\n\r\n        static $inject = ['donateService', '$scope'];\r\n\r\n        constructor(\r\n            private service: Service,\r\n            private $scope: ng.IScope\r\n            ) {\r\n            this.message = 'Hello!';\r\n\r\n\r\n            $scope.$on(\r\n                'markersLoaded',\r\n                (event, markers: IMarkerInfo[]) => {\r\n                    this.markers = markers;\r\n                    this.markers.forEach(m=> {\r\n                        var mapMarker = new google.maps.Marker({\r\n                            position: new google.maps.LatLng(m.lat, m.lng),\r\n                            title: m.title\r\n                        });\r\n                        var infoWindow = new google.maps.InfoWindow({\r\n                            // TODO - template this in the view!\r\n                            // TODO - sanitize content/encode content!!\r\n                            content: '<b>' + m.title + '</b>'\r\n                        });\r\n                        mapMarker.addListener('click', () => {\r\n                            if (this.currentInfoWindow != null) {\r\n                                this.currentInfoWindow.close();\r\n                            }\r\n                            this.currentMarker = m;\r\n                            infoWindow.open(this.map, mapMarker);\r\n                            this.currentInfoWindow = infoWindow;\r\n                        }); \r\n                        mapMarker.setMap(this.map);\r\n                    });\r\n                });\r\n\r\n            this.service.loadMarkers();\r\n\r\n            this.initMap('map-container'); // TODO - hook this up in a directive???\r\n        };\r\n\r\n\r\n        initMap(mapElementId: string) {\r\n            var mapElement = document.getElementById(mapElementId);\r\n            var options: google.maps.MapOptions = {\r\n                center: new google.maps.LatLng(51.48, 0),\r\n                mapTypeId: google.maps.MapTypeId.ROADMAP,\r\n                zoom: 5\r\n            };\r\n            this.map = new google.maps.Map(mapElement, options);\r\n\r\n\r\n            if (navigator.geolocation) {\r\n                this.message = 'Finding your location...';\r\n                navigator.geolocation.getCurrentPosition(\r\n                    position => {\r\n                        this.$scope.$apply(() => this.message = null);\r\n\r\n                        var pos = {\r\n                            lat: position.coords.latitude,\r\n                            lng: position.coords.longitude\r\n                        };\r\n\r\n                        this.map.setCenter(pos);\r\n                        this.map.setZoom(10);\r\n                    },\r\n                    e => this.message = 'Failed to get your location');\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nangular.module('app')\r\n    .controller('donateController', Donate.Controller);\r\n"],"sourceRoot":"/source/"}